# ì½”ì–´ ììŠ¤ë¦½íŠ¸

## í”„ë¡œë¯¸ìŠ¤ì™€ async, await

### ì½œë°±

```javascript
const func = (error, callback) => {
  if (!error) {
    callback()
  }
}
```

### í”„ë¡œë¯¸ìŠ¤

```javascript
new Promise(function(resolve, reject) => {
  resolve(/* if success, result  */)

  reject(/* if failed, error  */)
})
promise.then(
  (result) =>  {}, /* ì—ëŸ¬ ë°œìƒ ì‹œ ì²˜ë¦¬ ë¶ˆê°€, ë‚´ë¶€ ì„ ì–¸ í•„ìš” */
  (error) => {},
)
promise
  .then((result) => {})
  .catch((error) => {})
  .finally(() => {})
```
- ìë°”ìŠ¤í¬ë¦½íŠ¸ ë‚´ë¶€ ì½œë°±ì¸ `Promise`
  - `[state]`: `pending(ë³´ë¥˜, ì²˜ë¦¬ì¤‘)`, `fulfilled`, `rejected`
  - `[result]`: `undefined`, `result`, `error`
- **ì„±ê³µ** ë˜ëŠ” **ì‹¤íŒ¨**ë§Œ ì¡´ì¬

### í”„ë¡œë¯¸ìŠ¤ ì²´ì´ë‹

> `thenable` : `.then()` ë©”ì„œë“œë¥¼ ê°–ëŠ” ê°ì²´

```javascript
new Promise()
  .then(() => {})
  .then(() => {})
  /* ... */
  .catch(() => {})
  .catch(() => {})
  /* ... */
  .finally(() => {})
fetch(/* URL */)
  .then((res) => res.json())
  .then((json) => console.log(json))
  .catch(() => {})
  .finally(() => {})
```

### í”„ë¡œë¯¸ìŠ¤ì™€ ì—ëŸ¬ í•¸ë“¤ë§

- í”„ë¡œë¯¸ìŠ¤ ê±°ë¶€ ì‹œ ê°€ê¹Œìš´ `.catch` ì‹¤í–‰
- **ì•”ì‹œì  `try..catch`** ë¥¼ ê°–ê³  ìˆìŒ 
  - ë™ê¸°ì ì¸ ì—ëŸ¬ ì²˜ë¦¬
- `.catch` ì‹¤í–‰ í›„ ê°€ê¹Œìš´ `.then` ì‹¤í–‰
  - **ì—ëŸ¬ ë°œìƒ ì‹œ ê°€ê¹Œìš´ `.catch` ì‹¤í–‰**
- ğŸš¨`.catch` ì—†ëŠ” ì—ëŸ¬ ë°œìƒì€ ë”ì°í•˜ê²Œ **ì „ì—­ ì—ëŸ¬(unhandledrejection**[^1] ë°œìƒğŸš¨
```javascript
window.addEventListener('unhandledrejection', (event) => {})
```

### í”„ë¡œë¯¸ìŠ¤ API

```javascript
/**
 * í•˜ë‚˜ ì‹¤íŒ¨ ì‹œ ëª¨ë‘ ì‹¤íŒ¨
 */
Promise
  .all([...new Promise()])
  .then(() => {})
  .catch(() => {})

/**
 * ìµœì†Œ í•˜ë‚˜ ì„±ê³µ ì‹œ ì„±ê³µ
 */
Promise
  .allSettled([... new Promise()])
  .then(() => {})
  .catch(() => {})

/**
 * ê°€ì¥ ë¹ ë¥¸ ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨
 */
Promise
  .race([... new Promise()])
  .then(() => {})
  .catch(() => {})
```

### ë§ˆì´í¬ë¡œíƒœìŠ¤í¬

- ë¹„ë™ê¸° ì‘ì—…ì€ `PromiseJobs` ë¼ëŠ” ë‚´ë¶€ í(V8: ë§ˆì´í¬ë¡œíƒœìŠ¤íŠ¸ í)ì—ì„œ ì²˜ë¦¬
  - FIFO
- ì²˜ë¦¬ë˜ì§€ ëª»í•œ ê±°ë¶€(`unhandledrejection`)ëŠ” ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ í ëì—ì„œ ì—ëŸ¬ê°€ ì²˜ë¦¬ë˜ì§€ ëª»í•  ë•Œ ë°œìƒ

### asyncì™€ await

- í•¨ìˆ˜ ì• `async`ë¥¼ ë¶™ì´ë©´ í•­ìƒ `Promise` ë°˜í™˜
- `await`ì€ `Promise`ê°€ ì²˜ë¦¬ë  ë•Œê¹Œì§€ ëŒ€ê¸° í›„ ë°˜í™˜(ì‹œê°ì  ë™ê¸° ì²˜ë¦¬)
- `await`ì€ `thenable` ê°ì²´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
  - `.then/catch/finally` ì‹¤í–‰ í›„ ë°˜í™˜



[^1]: https://html.spec.whatwg.org/multipage/webappapis.html#unhandled-promise-rejections
